<html>

<head>
    <meta charset="utf-8">
    <title> 회원가입 페이지 </title>
    <link rel="stylesheet" href="./main.css">
    <link rel="stylesheet" href="./default.css">
    <script src="./data.js "> </script>
</head>

<body>

    <div class="center vh">
        <img src="./logo.png">
        <div>
            <div>
                <div class="margin">
                    <input type="email" class="id input-type" id="id" placeholder="아이디 입력">
                    <label id="msg1" class="hidden show1">사용 가능한 아이디 입니다. </label>
                    <label id="msg2" class="hidden show2">사용 불가능한 아이디 입니다. </label>

                </div>
            </div>
            <div class="margin">
                <input type="password" class="pw input-type" id="pw" placeholder="비밀번호">
                <input type="password" class="CheckPW input-type" id="CheckPW" placeholder="비밀번호 확인">

            </div>
            <div class="pwtext">
                <label id="pwnok" class="hidden show2">비밀번호 불일치 </label>
                <label id="pwok" class="hidden show1">비밀번호 일치 </label>
            </div>
            <br>
            <div>
                <label id="null" class="hidden show2 margin-left">빈공간이 존재합니다.</label>
            </div>
            <div class="btn">
                <button type="button" id="btnjoin" class="btn-join">
                    회원가입
                </button>
                <a href="login.html" class="margin-left">로그인 하러 가기</a>
            </div>
        </div>
    </div>
    </div>
</body>
<script>
    
    const $id = document.getElementById('id');
    const $pw = document.getElementById('pw');
    const $CheckPW = document.getElementById('CheckPW');
    const $btnjoin = document.getElementById('btnjoin');
    const $msg = document.getElementById('msg');
    const $msg1 = document.getElementById('msg1');
    const $msg2 = document.getElementById('msg2');
    const $pwnok = document.getElementById('pwnok');
    const $pwok = document.getElementById('pwok');
    const $null = document.getElementById('null');
    let j = 0;

    $btnjoin.addEventListener("click", joinHandler);
    $btnjoin.disabled = 'disabled';
    $id.addEventListener("blur", NullCheck);
    $pw.addEventListener("blur", NullCheck);
    $id.addEventListener("blur", msg);
    $CheckPW.addEventListener("blur", NullCheck);
    $CheckPW.addEventListener("blur", pwCheck);
    $pw.addEventListener("blur", pwCheck);
    // 회원가입시 데이터 넘겨주는 함수
    function joinHandler() {
        users.push({id : id.value, pw : pw.value});
        localStorage.setItem("user",JSON.stringify(users));

        console.log(users);
        location.href = "./login.html";
    }

    //비밀번호 일치 함수
    function pwCheck() {
        if ($pw.value == '') {
            $pwok.classList.remove('show1');
            $pwok.classList.add('hidden');
            $pwnok.classList.remove('show2');
            $pwnok.classList.add('hidden');
            return;
        }
        //비밀번호 일치

        if ($pw.value == $CheckPW.value) {
            $pwnok.classList.remove('show2');
            $pwok.classList.remove('hidden');
            $pwnok.classList.add('hidden');
            $pwok.classList.add('show1');
            j++;
            btnon();
        }
        else { //비밀번호 불일치 
            $pwnok.classList.remove('hidden');
            $pwnok.classList.add('show2');
            $pwok.classList.add('hidden');
            $pwok.classList.remove('show1');
        }
    }
    // 빈공간 체크 함수
    function NullCheck($id, $pw, $CheckPW) {
        if (id.value == '' || pw.value == '' || CheckPW.value == '') {
            $null.classList.remove('hidden');
        }
        else {
            $null.classList.add('hidden');
            return true;
        }
    }
    // 메세지 출력 함수
    function msg() {
        //사용 불가능 아이디
        if ($id.value === '') {
            $msg1.classList.remove('show1');
            $msg1.classList.add('hidden');
            return;
        }
        const join = getUser($id.value);
        if (join != null && $id.value != "") {
            $msg2.classList.remove('hidden');
            $msg2.classList.add('show');
            $msg1.classList.add('hidden');
        }
        //사용 가능 아이디
        else if (join == null && $id.value != "") {
            $msg1.classList.remove('hidden');
            $msg1.classList.add('show1');
            $msg2.classList.add('hidden');
            if ($id.value == "") {
                $msg1.classList.remove('hidden');
                $msg2.classList.remove('hidden');

            }
            j++;
            btnon();
        }

    }
    //            if(event.target.parentNode.classList.contains("is-selected")){

    // 아이디 중복 여부 함수
    function getUser(id) {
        for (let i = 0; i < users.length; i++) {
            if (id == users[i].id) {
                return users[i];
            }
        }
        return null;
    }
    // 버튼 활성화
    function btnon() {
        if (j % 2 == 0) {
            $btnjoin.disabled = false;
        }
        return false;
    }


</script>

</html>